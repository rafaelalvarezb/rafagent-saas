<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test de Lógica de Zona Horaria del Usuario - RafAgent</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 900px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .test-section {
            margin: 20px 0;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
        }
        .success { background-color: #d4edda; border-color: #c3e6cb; }
        .error { background-color: #f8d7da; border-color: #f5c6cb; }
        .info { background-color: #d1ecf1; border-color: #bee5eb; }
        .warning { background-color: #fff3cd; border-color: #ffeaa7; }
        button {
            background-color: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover { background-color: #0056b3; }
        .log {
            background-color: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 5px;
            padding: 10px;
            margin: 10px 0;
            font-family: monospace;
            white-space: pre-wrap;
            max-height: 400px;
            overflow-y: auto;
        }
        .scenario {
            background-color: #f8f9fa;
            padding: 15px;
            border-left: 4px solid #007bff;
            margin: 15px 0;
        }
        .user-info {
            background-color: #e7f3ff;
            padding: 10px;
            border-radius: 5px;
            margin: 10px 0;
        }
        .prospect-response {
            background-color: #fff3cd;
            padding: 10px;
            border-radius: 5px;
            margin: 10px 0;
            font-style: italic;
        }
        .meeting-result {
            background-color: #d4edda;
            padding: 10px;
            border-radius: 5px;
            margin: 10px 0;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>🎯 Test de Lógica de Zona Horaria del Usuario - RafAgent</h1>
        
        <div class="test-section info">
            <h3>📋 Lógica Implementada</h3>
            <ul>
                <li>✅ <strong>Detección automática:</strong> Detecta la zona horaria del usuario al registrarse</li>
                <li>✅ <strong>Asunción inteligente:</strong> Cuando el prospecto dice "2 PM" sin especificar zona, asume la zona del usuario</li>
                <li>✅ <strong>Respeto a working hours:</strong> Usa la configuración de horarios de trabajo del usuario</li>
                <li>✅ <strong>Backup manual:</strong> El usuario puede cambiar su zona horaria en configuración</li>
            </ul>
        </div>

        <div class="test-section">
            <h3>🧪 Test de Escenarios Reales</h3>
            <p>Prueba cómo el sistema maneja diferentes usuarios y respuestas de prospectos:</p>
            
            <button onclick="testMexicoUser()">🇲🇽 Usuario en México</button>
            <button onclick="testSanFranciscoUser()">🇺🇸 Usuario en San Francisco</button>
            <button onclick="testBuenosAiresUser()">🇦🇷 Usuario en Buenos Aires</button>
            <button onclick="testManualTimezoneChange()">⚙️ Cambio Manual de Zona Horaria</button>
            <button onclick="clearLog()">Limpiar Log</button>
            
            <div id="test-log" class="log"></div>
        </div>

        <div class="test-section">
            <h3>📊 Simulación de Configuración de Usuario</h3>
            <p>Simula la configuración actual del usuario:</p>
            
            <div class="user-info">
                <strong>Zona Horaria Detectada:</strong> <span id="detected-timezone">Detectando...</span><br>
                <strong>Zona Horaria Configurada:</strong> <span id="configured-timezone">-</span><br>
                <strong>Horarios de Trabajo:</strong> <span id="working-hours">9:00 - 17:00</span><br>
                <strong>Días de Trabajo:</strong> <span id="working-days">Lunes - Viernes</span>
            </div>
            
            <button onclick="simulateUserLogin()">🔐 Simular Login de Usuario</button>
            <button onclick="changeUserTimezone()">🌍 Cambiar Zona Horaria</button>
        </div>

        <div class="test-section">
            <h3>💬 Simulador de Respuestas de Prospectos</h3>
            <p>Simula diferentes respuestas de prospectos y cómo las interpreta el sistema:</p>
            
            <div id="prospect-responses">
                <div class="prospect-response">
                    <strong>Respuesta 1:</strong> "¿Podemos hablar el viernes a las 2 PM?"
                </div>
                <div class="prospect-response">
                    <strong>Respuesta 2:</strong> "Sure, we can talk on friday 2 pm"
                </div>
                <div class="prospect-response">
                    <strong>Respuesta 3:</strong> "¿Puede ser el viernes a las 9 AM?"
                </div>
                <div class="prospect-response">
                    <strong>Respuesta 4:</strong> "Claro, el viernes a las 3 PM está bien"
                </div>
            </div>
            
            <button onclick="testAllResponses()">🧪 Probar Todas las Respuestas</button>
        </div>
    </div>

    <script>
        let currentUserTimezone = null;
        let currentWorkingHours = { start: 9, end: 17 };
        let currentWorkingDays = ['monday', 'tuesday', 'wednesday', 'thursday', 'friday'];

        function log(message, type = 'info') {
            const logDiv = document.getElementById('test-log');
            const timestamp = new Date().toLocaleString();
            const className = type === 'error' ? 'error' : type === 'success' ? 'success' : type === 'warning' ? 'warning' : 'info';
            logDiv.innerHTML += `<div class="${className}">[${timestamp}] ${message}</div>`;
            logDiv.scrollTop = logDiv.scrollHeight;
        }

        function clearLog() {
            document.getElementById('test-log').innerHTML = '';
        }

        function simulateUserLogin() {
            log('🔐 Simulando login de usuario...');
            
            // Simular detección automática
            const detected = Intl.DateTimeFormat().resolvedOptions().timeZone;
            currentUserTimezone = detected;
            
            log(`🌍 Zona horaria detectada: ${detected}`, 'success');
            log(`🕐 Hora actual en tu zona: ${new Date().toLocaleString('es-MX', { timeZone: detected })}`);
            
            // Actualizar display
            document.getElementById('detected-timezone').textContent = detected;
            document.getElementById('configured-timezone').textContent = detected;
            
            // Simular configuración de working hours
            log(`⏰ Horarios de trabajo configurados: ${currentWorkingHours.start}:00 - ${currentWorkingHours.end}:00`);
            log(`📅 Días de trabajo: ${currentWorkingDays.join(', ')}`);
            
            document.getElementById('working-hours').textContent = `${currentWorkingHours.start}:00 - ${currentWorkingHours.end}:00`;
            document.getElementById('working-days').textContent = currentWorkingDays.join(', ');
        }

        function changeUserTimezone() {
            const newTimezone = prompt('Ingresa nueva zona horaria (ej: America/New_York, America/Los_Angeles):');
            if (newTimezone) {
                currentUserTimezone = newTimezone;
                document.getElementById('configured-timezone').textContent = newTimezone;
                log(`🌍 Zona horaria cambiada a: ${newTimezone}`, 'success');
                log(`🕐 Hora actual en nueva zona: ${new Date().toLocaleString('es-MX', { timeZone: newTimezone })}`);
            }
        }

        function testMexicoUser() {
            log('🇲🇽 === USUARIO EN MÉXICO ===', 'info');
            
            currentUserTimezone = 'America/Mexico_City';
            currentWorkingHours = { start: 9, end: 17 };
            
            log(`👤 Usuario: México (GMT-6)`);
            log(`⏰ Horarios de trabajo: 9:00 - 17:00 (hora de México)`);
            
            // Simular respuestas de prospectos
            const responses = [
                "¿Podemos hablar el viernes a las 2 PM?",
                "¿Puede ser el viernes a las 9 AM?",
                "Claro, el viernes a las 3 PM está bien"
            ];
            
            responses.forEach((response, index) => {
                log(`📧 Prospecto dice: "${response}"`);
                
                // El sistema asume que "2 PM" se refiere a 2 PM hora de México
                const timeMatch = response.match(/(\d{1,2}):?(\d{2})?\s*(AM|PM|am|pm)?/i);
                if (timeMatch) {
                    let hour = parseInt(timeMatch[1]);
                    const period = timeMatch[3]?.toUpperCase();
                    
                    if (period === 'PM' && hour !== 12) hour += 12;
                    if (period === 'AM' && hour === 12) hour = 0;
                    
                    log(`🎯 Sistema interpreta: ${hour}:00 hora de México`, 'success');
                    log(`✅ Reunión agendada para: Viernes ${hour}:00 (hora de México)`, 'success');
                }
                log('---');
            });
        }

        function testSanFranciscoUser() {
            log('🇺🇸 === USUARIO EN SAN FRANCISCO ===', 'info');
            
            currentUserTimezone = 'America/Los_Angeles';
            currentWorkingHours = { start: 9, end: 17 };
            
            log(`👤 Usuario: San Francisco (GMT-8)`);
            log(`⏰ Horarios de trabajo: 9:00 - 17:00 (hora de San Francisco)`);
            
            // Simular respuestas de prospectos
            const responses = [
                "Sure, we can talk on friday 2 pm",
                "Can we schedule for friday 9 am?",
                "Friday 3 pm works for me"
            ];
            
            responses.forEach((response, index) => {
                log(`📧 Prospecto dice: "${response}"`);
                
                // El sistema asume que "2 pm" se refiere a 2 PM hora de San Francisco
                const timeMatch = response.match(/(\d{1,2}):?(\d{2})?\s*(AM|PM|am|pm)?/i);
                if (timeMatch) {
                    let hour = parseInt(timeMatch[1]);
                    const period = timeMatch[3]?.toUpperCase();
                    
                    if (period === 'PM' && hour !== 12) hour += 12;
                    if (period === 'AM' && hour === 12) hour = 0;
                    
                    log(`🎯 Sistema interpreta: ${hour}:00 hora de San Francisco`, 'success');
                    log(`✅ Reunión agendada para: Viernes ${hour}:00 (hora de San Francisco)`, 'success');
                }
                log('---');
            });
        }

        function testBuenosAiresUser() {
            log('🇦🇷 === USUARIO EN BUENOS AIRES ===', 'info');
            
            currentUserTimezone = 'America/Argentina/Buenos_Aires';
            currentWorkingHours = { start: 9, end: 17 };
            
            log(`👤 Usuario: Buenos Aires (GMT-3)`);
            log(`⏰ Horarios de trabajo: 9:00 - 17:00 (hora de Buenos Aires)`);
            
            // Simular respuestas de prospectos
            const responses = [
                "¿Podemos hablar el viernes a las 2 PM?",
                "¿Puede ser el viernes a las 9 AM?",
                "Claro, el viernes a las 3 PM está bien"
            ];
            
            responses.forEach((response, index) => {
                log(`📧 Prospecto dice: "${response}"`);
                
                // El sistema asume que "2 PM" se refiere a 2 PM hora de Buenos Aires
                const timeMatch = response.match(/(\d{1,2}):?(\d{2})?\s*(AM|PM|am|pm)?/i);
                if (timeMatch) {
                    let hour = parseInt(timeMatch[1]);
                    const period = timeMatch[3]?.toUpperCase();
                    
                    if (period === 'PM' && hour !== 12) hour += 12;
                    if (period === 'AM' && hour === 12) hour = 0;
                    
                    log(`🎯 Sistema interpreta: ${hour}:00 hora de Buenos Aires`, 'success');
                    log(`✅ Reunión agendada para: Viernes ${hour}:00 (hora de Buenos Aires)`, 'success');
                }
                log('---');
            });
        }

        function testManualTimezoneChange() {
            log('⚙️ === CAMBIO MANUAL DE ZONA HORARIA ===', 'info');
            
            log(`👤 Usuario original: México (GMT-6)`);
            log(`🌍 Usuario cambia a: Nueva York (GMT-5)`);
            
            currentUserTimezone = 'America/New_York';
            
            log(`📧 Prospecto dice: "¿Podemos hablar el viernes a las 2 PM?"`);
            log(`🎯 Sistema interpreta: 2 PM hora de Nueva York (nueva configuración)`, 'success');
            log(`✅ Reunión agendada para: Viernes 14:00 (hora de Nueva York)`, 'success');
            
            log(`📝 Nota: El sistema respeta la zona horaria configurada manualmente`, 'info');
        }

        function testAllResponses() {
            log('🧪 === PROBANDO TODAS LAS RESPUESTAS ===', 'info');
            
            if (!currentUserTimezone) {
                log('❌ Primero simula el login de un usuario', 'error');
                return;
            }
            
            const responses = [
                "¿Podemos hablar el viernes a las 2 PM?",
                "Sure, we can talk on friday 2 pm",
                "¿Puede ser el viernes a las 9 AM?",
                "Claro, el viernes a las 3 PM está bien"
            ];
            
            responses.forEach((response, index) => {
                log(`📧 Respuesta ${index + 1}: "${response}"`);
                
                const timeMatch = response.match(/(\d{1,2}):?(\d{2})?\s*(AM|PM|am|pm)?/i);
                if (timeMatch) {
                    let hour = parseInt(timeMatch[1]);
                    const period = timeMatch[3]?.toUpperCase();
                    
                    if (period === 'PM' && hour !== 12) hour += 12;
                    if (period === 'AM' && hour === 12) hour = 0;
                    
                    log(`🎯 Sistema asume: ${hour}:00 hora de ${currentUserTimezone}`, 'success');
                    
                    // Verificar si está dentro de working hours
                    if (hour >= currentWorkingHours.start && hour < currentWorkingHours.end) {
                        log(`✅ Dentro de horarios de trabajo: ${currentWorkingHours.start}:00 - ${currentWorkingHours.end}:00`, 'success');
                    } else {
                        log(`⚠️ Fuera de horarios de trabajo, buscará el slot más cercano`, 'warning');
                    }
                }
                log('---');
            });
        }

        // Test automático al cargar la página
        window.onload = function() {
            log('🚀 Página de test cargada. Simula el login de un usuario para comenzar.');
        };
    </script>
</body>
</html>
